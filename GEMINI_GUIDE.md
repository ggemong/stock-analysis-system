# 📋 Gemini AI 프롬프트 및 파일 인코딩 가이드

**버전:** 1.4.0  
**업데이트:** 2026-01-30

---

## ✅ 1. Gemini 프롬프트 - 페르소나 설정

### 🎯 현재 설정된 페르소나

시스템이 생성하는 모든 Gemini 프롬프트에는 다음 페르소나가 포함됩니다:

```
🎯 역할 설정 (Persona)

당신은 **20년 경력의 퀀트 애널리스트이자 포트폴리오 매니저**입니다.

전문 분야:
- 기술적 분석 (Technical Analysis) 전문가
- 글로벌 거시경제 및 환율 분석
- 자산배분 및 리스크 관리
- 다양한 자산군 (주식, ETF, 암호화폐) 운용 경험

분석 철학:
- 데이터 기반 의사결정
- 보수적이고 객관적인 시각
- 리스크 관리 최우선
- 감정 배제, 원칙 준수

분석 스타일:
- 명확한 근거 제시
- 구체적 수치와 데이터 활용
- 장단점 균형있게 서술
- 실행 가능한 조언
```

### 왜 이 페르소나인가?

1. **퀀트 애널리스트**: 데이터 중심, 감정 배제
2. **포트폴리오 매니저**: 자산 배분 및 리스크 관리 전문
3. **20년 경력**: 충분한 경험과 신뢰성
4. **보수적 접근**: 투자자 보호 우선

---

## ✅ 2. 환율 및 거시경제 지표 - 필수 반영

### 📊 프롬프트에 포함된 지표

시스템은 **반드시** 다음 지표를 Gemini에게 전달하고 분석을 요청합니다:

#### 환율
```
USD/KRW: 1320.50 (-0.50%)
```
- 미국 자산 투자 시 환차손익 직접 영향
- 환율 상승 = 달러 강세 = 원화 약세
- 미국 주식 수익률에 환율 변동 추가/차감

#### 거시경제 지표
```
- VIX: 16.50 (-2.30%)
- FED_RATE: 4.50%
- UNEMPLOYMENT: 3.70%
- INFLATION: 3.20%
- 10Y_TREASURY: 4.20%
```

### 💡 지표별 투자 의미

| 지표 | 상승 시 | 하락 시 |
|------|--------|--------|
| **VIX** | 리스크 오프 (금↑, 주식↓) | 리스크 온 (주식↑, 금↓) |
| **금리** | 주식↓, REITs↓, 채권↓ | 주식↑, REITs↑, 채권↑ |
| **실업률** | 경제 약세 (주식↓) | 경제 강세 (주식↑) |
| **인플레이션** | 금↑, 실물자산↑ | 금↓, 성장주↑ |
| **환율(원화)** | 미국 자산 수익률↑ | 미국 자산 수익률↓ |

### 📋 Gemini 분석 요청사항

프롬프트는 Gemini에게 다음을 **명시적으로 요청**합니다:

```
1. 거시경제 및 환율 종합 평가 ⭐ 필수

반드시 다음을 분석하세요:
- 환율 (USD/KRW): 현재 1320.50원
  - 환율 상승/하락이 미국 자산 투자에 미치는 영향
  - 환차손익 고려사항
  
- VIX 지수: 시장 변동성 및 투자심리
  - VIX 높음 → 리스크 오프 (금 ETF 매력도↑, 주식↓)
  - VIX 낮음 → 리스크 온 (주식 선호)

- 금리 환경: Fed 금리 및 10년물 국채
  - 금리 상승 → REITs 부담↑, 성장주 밸류에이션↓
  - 금리 하락 → REITs 매력↑, 성장주 선호

- 종합 투자 환경: 위 지표들을 종합하여 
  현재가 "리스크 온" 구간인지 "리스크 오프" 구간인지 판단
```

---

## ✅ 3. 파일 인코딩 - UTF-8 완벽 지원

### 🔧 현재 설정

시스템의 모든 파일 입출력은 **UTF-8 인코딩**을 사용합니다:

#### Python 코드 설정
```python
# main.py - 파일 저장
with open(output_file, 'w', encoding='utf-8') as f:
    json.dump(gemini_data, f, indent=2, ensure_ascii=False)

# telegram_notifier.py - 파일 전송
file_obj = BytesIO(file_content.encode('utf-8'))
```

#### JSON 설정
```python
json.dumps(data, indent=2, ensure_ascii=False)
```
- `ensure_ascii=False`: 한글을 유니코드 이스케이프(\uXXXX) 없이 그대로 저장
- `encoding='utf-8'`: UTF-8 인코딩 사용

### 📂 생성되는 파일

1. **로컬 저장**: `analysis_result_YYYYMMDD_HHMMSS.json`
2. **텔레그램 전송**: `stock_analysis_YYYYMMDD_HHMMSS.json`
3. **프롬프트 파일**: `gemini_prompt_YYYYMMDD_HHMMSS.txt`

**모두 UTF-8 인코딩**으로 저장됩니다.

### 🔍 한글이 깨져 보이는 경우

#### 문제 1: 텍스트 에디터 문제
**증상:**
```json
{"name": "\uc0bc\uc131\uc804\uc790"}
```

**원인:** 텍스트 에디터가 UTF-8을 지원하지 않거나 자동 감지 실패

**해결:**
1. **VS Code**: 우측 하단에서 인코딩 확인 → "UTF-8" 선택
2. **Notepad++**: 메뉴 → 인코딩 → "UTF-8" 선택
3. **메모장 (Windows)**: 다른 이름으로 저장 → 인코딩 "UTF-8" 선택

#### 문제 2: 터미널/콘솔 문제
**증상:** 터미널에서 한글이 깨짐

**해결:**
```bash
# Linux/Mac
export LANG=ko_KR.UTF-8

# Windows (PowerShell)
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
```

#### 문제 3: Git/GitHub 문제
**증상:** GitHub에서 한글이 깨짐

**해결:**
```bash
git config --global core.quotepath false
git config --global i18n.commitEncoding utf-8
git config --global i18n.logOutputEncoding utf-8
```

### ✅ 인코딩 테스트

시스템이 올바르게 작동하는지 확인:

```bash
python -c "
import json
with open('analysis_result_최신파일.json', 'r', encoding='utf-8') as f:
    data = json.load(f)
    print(data['stocks'][0]['name'])
"
```

**예상 출력:** `삼성전자` (정상)  
**문제 출력:** `\uc0bc\uc131\uc804\uc790` (에디터 문제)

---

## 📊 전체 프롬프트 구조

```
1. 🎯 역할 설정 (Persona)
   - 20년 경력 퀀트 애널리스트
   - 전문 분야, 철학, 스타일 명시

2. 📊 시장 환경 분석
   - 환율 정보 (USD/KRW)
   - 거시경제 지표 (VIX, 금리 등)
   - 💡 지표의 투자 의미 설명

3. 📈 보유 주식 분석
   - 각 종목별 기술적 지표
   - 현재가, RSI, 이평선, 크로스 등

4. 📊 투자 전략 가이드라인
   - 자산 유형별 전략 (5가지)
   - 전략 적용 우선순위

5. 🎯 분석 요청사항
   - 거시경제 및 환율 종합 평가 (필수!)
   - 자산 유형별 분석
   - 개별 종목 분석
   - 포트폴리오 제안
   - 리스크 관리
   - 실행 전략
```

---

## 💡 실전 활용 팁

### 1. Gemini에 JSON 업로드
```
1. 텔레그램에서 JSON 파일 다운로드
2. Gemini AI 접속 (gemini.google.com)
3. 파일 업로드 (📎 버튼)
4. 자동 생성된 프롬프트 복사 & 붙여넣기
```

### 2. 환율/거시경제 중점 분석 요청
프롬프트에 추가 요청:
```
특히 다음을 상세히 분석해주세요:
- 현재 환율 1320원이 향후 미국 자산 수익률에 미치는 영향
- VIX 16.5 수준에서의 리스크 온/오프 판단
- 금리 환경이 REITs와 테크주에 미치는 차별적 영향
```

### 3. 한글 파일 확인
```bash
# 파일 인코딩 확인 (Linux/Mac)
file -I analysis_result_*.json

# 예상 출력: charset=utf-8

# Windows
chcp 65001  # UTF-8 코드 페이지로 변경
type analysis_result_*.json
```

---

## 🔧 문제 해결

### Q1: Gemini가 거시경제를 분석하지 않아요
**A:** 프롬프트를 확인하세요. 시스템이 생성한 프롬프트에는 "⭐ 필수" 표시와 함께 거시경제 분석이 명시되어 있습니다. 프롬프트 전체를 복사했는지 확인하세요.

### Q2: JSON 파일 한글이 \uXXXX로 보여요
**A:** 정상입니다. 이는 유니코드 이스케이프 표현이며, 프로그램(Python, Gemini 등)에서는 올바르게 한글로 표시됩니다. 텍스트 에디터에서 보고 싶다면 UTF-8을 지원하는 에디터를 사용하세요.

### Q3: 텔레그램에서 한글이 깨져요
**A:** 텔레그램 앱 자체는 UTF-8을 완벽 지원합니다. 파일을 다운로드한 후 여는 프로그램의 문제일 수 있습니다.

---

## 📚 관련 문서

- `STRATEGY_GUIDE.md`: 자산 유형별 투자 전략
- `TELEGRAM_EXAMPLE.md`: 텔레그램 메시지 예시
- `PORTFOLIO.md`: 포트폴리오 구성

---

**버전 히스토리:**
- v1.4.0 (2026-01-30): 페르소나, 거시경제 필수 반영, UTF-8 완벽 지원
- v1.3.0 (2026-01-30): 자산 유형별 전략 추가
- v1.2.0 (2026-01-30): 장기 이평선 정보 추가
